(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cf32e"],{6361:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"vx-row"},[r("div",{staticClass:"vx-col md:w-1/2 w-full mb-base"},[r("vx-card",[e.can("propose","Enterprise")?[r("vs-select",{staticClass:"w-full mb-6",attrs:{label:e.$t("GLOBALS.ORGANIZER_FOR_PROPOSE"),autocomplete:""},model:{value:e.schoolOrganizer,callback:function(t){e.schoolOrganizer=t},expression:"schoolOrganizer"}},e._l(e.schoolOrganizers.models,(function(t){return r("vs-select-item",{key:t.username,attrs:{value:t,text:e.getNiceName(t)}})})),1),r("vs-input",{staticClass:"w-full mb-6",attrs:{label:e.$t("GLOBALS.CONTACT_NAME"),type:"text"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),r("vs-input",{staticClass:"w-full mb-6",attrs:{label:e.$t("GLOBALS.CONTACT_EMAIL"),type:"email"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),r("vs-input",{staticClass:"w-full mb-6",attrs:{label:e.$t("GLOBALS.CONTACT_PHONE"),type:"text"},model:{value:e.phone,callback:function(t){e.phone=t},expression:"phone"}})]:e._e(),e._l(e.enterpriseObject.fieldsSettings(),(function(t,n){return[e.isVisible(t,n)?["select"===t.type?r("v-select-box",{key:n,attrs:{settings:t,object:e.enterpriseObject,field:n}}):r("v-text-box",{key:n,attrs:{object:e.enterpriseObject,field:n}})]:e._e()]})),r("div",{staticClass:"vx-row"},[r("div",{staticClass:"vx-col sm:w-3/3 w-full text-right"},[e.can("create","Enterprise")||e.can("update","Enterprise")?r("vs-button",{staticClass:"mr-3 mb-2",on:{click:e.submit}},[e._v("\n            "+e._s(e.$t("GLOBALS.SUBMIT")))]):e._e(),e.can("propose","Enterprise")?r("vs-button",{staticClass:"mr-3 mb-2",on:{click:e.propose}},[e._v(e._s(e.$t("GLOBALS.PROPOSE_BY_SENDING_EMAIL")))]):e._e()],1)])],2)],1)])},s=[],i=(r("7f7f"),r("ac6a"),r("456d"),r("6762"),r("2fdb"),r("7514"),r("96cf"),r("3b8d")),a=(r("c5f6"),r("1d63")),c=r("18c6"),o=r("2bcd"),u=r("f5c3"),l=r("7550"),h=r("ebd1"),p={components:{VTextBox:c["a"],VSelectBox:o["a"]},props:{enterprise:{type:Object,default:function(){return new a["a"]}},id:{type:[Number,String],default:function(){return null}}},data:function(){return{enterpriseObject:this.enterprise,studyCompetences:new u["b"],studyPrograms:new l["b"],users:new h["b"],schoolOrganizer:null,schoolOrganizers:new h["b"],name:"",phone:"",email:""}},mounted:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.$acl.not.check("admin")&&(this.enterprise.school_id=this.$store.state.AppActiveUser.school),this.enterpriseObject.id||!this.id){e.next=5;break}return t=new a["b"],e.next=5,t.fetch().then((function(){r.enterpriseObject=t.find((function(e){return e.id===parseInt(r.id)}))}));case 5:return e.next=7,this.users.fetchInSchool();case 7:this.schoolOrganizers=this.users.filter((function(e){return e.roles.includes("ROLE_SCHOOLORG")}));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{isVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return("school_id"!==t||!this.$acl.not.check("admin"))&&(this.enterpriseObject.id?e.showOnUpdate:e.showOnCreate)},validate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.enterpriseObject.validate();case 2:if(t=e.sent,0===Object.keys(t).length){e.next=6;break}return this.$vs.notify({color:"danger",title:this.$t("GLOBALS.ERROR_ON_SAVE"),text:this.$t("VALIDATION.ERROR")}),e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),findFirstAdminWithEmail:function(){return this.users.find((function(e){return e.email&&e.roles.includes("ROLE_SCHOOLORG")}))},propose:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.validate();case 2:if(e.sent){e.next=4;break}return e.abrupt("return",!1);case 4:if(this.activeUser.email){e.next=7;break}return this.errorMessage(this.$t("GLOBALS.YOU_MISSING_EMAIL")),e.abrupt("return");case 7:if(this.activeUser.first_name){e.next=10;break}return this.errorMessage(this.$t("GLOBALS.YOU_MISSING_FIRST_NAME")),e.abrupt("return");case 10:if(this.activeUser.last_name){e.next=13;break}return this.errorMessage(this.$t("GLOBALS.YOU_MISSING_LAST_NAME")),e.abrupt("return");case 13:if(t="",t+="Proposed by:  "+this.activeUser.first_name+" "+this.activeUser.last_name+" ("+this.activeUser.username+" - "+this.activeUser.email+")<br>",t+="Contact name: "+this.name+"<br>",t+="Contact email: "+this.email+"<br>",t+="Contact phone: "+this.phone+"<br>",t+="Name of the organization: "+this.enterpriseObject.name+"<br>",t+="Street name: "+this.enterpriseObject.streetname+"<br>",t+="City: "+this.enterpriseObject.cityname+"<br>",t+="Zip: "+this.enterpriseObject.cityzipcode+"<br>",t+="Study programs: "+this.enterpriseObject.studyPrograms.map((function(e){return e.name})).join(", ")+"<br>",this.schoolOrganizer&&this.schoolOrganizer.email){e.next=26;break}return this.errorMessage(this.$t("GLOBALS.ADMIN_MAIL_MISSING")),e.abrupt("return");case 26:this.sendMail(this.activeUser.email,this.schoolOrganizer.email,this.$t("GLOBALS.NEW_ENTERPRISE_SUGGESTED")+": "+this.enterpriseObject.name,t).then((function(){r.$router.push({name:"enterprises"})}));case 27:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t="save",this.enterpriseObject.id&&(t="patch"),this.enterpriseObject[t]().then((function(){r.$router.push({name:"enterprises"}),r.$vs.notify({color:"success",title:r.$t("GLOBALS.RECORD_CREATED"),text:r.$t("GLOBALS.RECORD_SUCCESSFULLY_CREATED")})})).catch((function(e){r.showValidationErrors(r.enterpriseObject),r.$vs.notify({color:"danger",title:r.$t("GLOBALS.ERROR_ON_SAVE"),text:e.message})}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getNiceName:function(e){return e.first_name+" "+e.last_name+" ("+e.username+")"}}},b=p,m=r("2877"),O=Object(m["a"])(b,n,s,!1,null,null,null);t["default"]=O.exports}}]);
//# sourceMappingURL=chunk-2d0cf32e.150e5662.js.map