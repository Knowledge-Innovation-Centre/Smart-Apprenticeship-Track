(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e17c4"],{"7b47":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col md:w-1/2 w-full mb-base"},[e.id?s("h2",{staticClass:"mb-4"},[e._v(e._s(e.userObject.username))]):e._e(),s("vx-card",[e.id?s("div",{staticClass:"mb-5"},[e._v("\n        "+e._s(e.$t("GLOBALS.ROLES"))+":\n        "),e._l(e.userObject.roles,(function(t){return[s("p",{key:t}),e._v("\n          "+e._s(e.getRoleName(t))+"\n        ")]}))],2):e._e(),e._l(e.fieldSettings,(function(t,r){return[e.isVisible(t,r)?["select"===t.type?s("v-select-box",{key:r,attrs:{object:e.userObject,settings:t,field:r}}):s("v-text-box",{key:r,attrs:{object:e.userObject,field:r}})]:e._e()]})),s("div",{staticClass:"vx-row mb-6"},[s("div",{staticClass:"vx-col  w-full"},[s("vs-select",{staticClass:"w-full",attrs:{danger:e.organizationError,"danger-text":e.organizationErrorText,label:e.$t("GLOBALS.ORGANIZATION_OR_SCHOOL")+" *",autocomplete:""},model:{value:e.userObject.organization,callback:function(t){e.$set(e.userObject,"organization",t)},expression:"userObject.organization"}},e._l(e.organizationItems,(function(e){return s("vs-select-item",{key:e.id,attrs:{value:e.id,text:e.name}})})),1)],1)]),e.isAdmin?s("div",{staticClass:"vx-row mb-6"},[s("div",{staticClass:"vx-col  w-full"},[s("vs-select",{staticClass:"w-full",attrs:{label:e.$t("GLOBALS.ROLES")+" *",multiple:!0,autocomplete:""},model:{value:e.selectedRoles,callback:function(t){e.selectedRoles=t},expression:"selectedRoles"}},e._l(e.roles,(function(e){return s("vs-select-item",{key:e.id,attrs:{value:e.id,text:e.name}})})),1)],1)]):e._e()],2)],1),s("div",{staticClass:"vx-col sm:w-3/3 w-full ml-auto"},[e.userObject.jwt?e._e():s("vs-button",{staticClass:"mr-3 mb-2 float-right",on:{click:e.changePassword}},[e._v(e._s(e.$t("USERS.CHANGE_PASSWORD")))]),s("vs-button",{staticClass:"mr-3 mb-2",on:{click:e.submit}},[e._v(e._s(e.$t("GLOBALS.SUBMIT")))])],1)])},n=[],i=(s("ac6a"),s("456d"),s("7514"),s("96cf"),s("3b8d")),o=(s("6762"),s("2fdb"),s("c5f6"),s("ebd1")),a=s("18c6"),c=s("2bcd"),u=s("7f97"),l=s("1d63"),h=s("0006"),O={components:{VTextBox:a["a"],VSelectBox:c["a"]},props:{user:{type:Object,default:function(){return new o["a"]}},saveMethod:{type:String,default:function(){return"save"}},id:{type:[Number,String],default:function(){return null}},role:{type:String,default:function(){return null}}},data:function(){return{userObject:this.user,organizationItems:[],selectedRoles:[],roles:[],organizationError:!1,organizationErrorText:""}},computed:{fieldSettings:function(){return this.userObject.fieldsSettings()},redirect:function(){return this.can("viewAll","User")?{name:"users"}:{name:"users-in-organization"}},checkOrganizationUser:function(){if(["ROLE_ORGADMIN","ROLE_MENTOR"].includes(this.role))return!0;if(!this.role){if(this.userObject.roles.includes("ROLE_ORGADMIN"))return!0;if(this.userObject.roles.includes("ROLE_MENTOR"))return!0}return!1},checkSchoolUser:function(){if(["ROLE_SCHOOLADMIN","ROLE_SCHOOLORG","ROLE_STUDENT"].includes(this.role))return!0;if(!this.role){if(this.userObject.roles.includes("ROLE_SCHOOLADMIN"))return!0;if(this.userObject.roles.includes("ROLE_SCHOOLORG"))return!0;if(this.userObject.roles.includes("ROLE_STUDENT"))return!0}return!1}},watch:{role:function(){this.userObject=new o["a"],this.userObject.roles.push(this.role),this.selectedRoles=[this.role],this.setUserData(),this.updateOrganizationValues()},selectedRoles:function(){this.userObject.roles=this.selectedRoles}},mounted:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.role&&(this.userObject=new o["a"],this.userObject.roles.push(this.role)),e.next=3,this.setUserData();case 3:t=new h["a"],this.roles=t.getRoles(),this.updateOrganizationValues();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{setUserData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.userObject.id||!this.id){e.next=9;break}if(t=new o["b"],!this.can("viewAll","User")){e.next=7;break}return e.next=5,t.fetch().then((function(){s.userObject=t.find((function(e){return e.username===s.id})),s.selectedRoles=s.userObject.roles}));case 5:e.next=9;break;case 7:return e.next=9,t.fetchInSchool().then((function(){s.userObject=t.find((function(e){return e.username===s.id})),s.selectedRoles=s.userObject.roles}));case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),updateOrganizationValues:function(){var e=this,t=new l["b"],s=new u["b"];this.checkOrganizationUser?t.fetch().then((function(){e.organizationItems=t.models})):this.checkSchoolUser?s.fetch().then((function(){e.organizationItems=s.models})):(s.fetch().then((function(){e.organizationItems=s.models})),s.fetch().then((function(){e.organizationItems.concat(s.models)})))},isVisible:function(e,t){return!(this.userObject.jwt&&!["studyprogram"].includes(t))&&(this.can("createAny","User")?this.id?e.showOnUpdate:e.showOnCreate:this.id?e.showOnUpdateForNonAdmin:e.showOnCreateForNonAdmin)},submit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.userObject.validate();case 2:if(t=e.sent,this.userObject.organization||(this.organizationError=!0,this.organizationErrorText="This field is required"),0===Object.keys(t).length){e.next=8;break}return this.showValidationErrors(this.userObject),this.$vs.notify({color:"danger",title:this.$t("GLOBALS.ERROR_ON_SAVE"),text:this.$t("GLOBALS.VALIDATION_ERROR")}),e.abrupt("return");case 8:if(this.userObject.roles.length){e.next=11;break}return this.$vs.notify({color:"danger",title:this.$t("GLOBALS.ERROR_ON_SAVE"),text:this.$t("GLOBALS.ROLE_REQUIRED")}),e.abrupt("return");case 11:this.id?this.userObject.modifyUser().then((function(){s.$router.push(s.redirect),s.$vs.notify({color:"success",title:s.$t("GLOBALS.RECORD_UPDATED"),text:s.$t("GLOBALS.RECORD_SUCCESSFULLY_UPDATED")})})).catch((function(e){s.showValidationErrors(s.userObject),s.$vs.notify({color:"danger",title:s.$t("GLOBALS.ERROR_ON_SAVE"),text:e.message})})):this.userObject[this.saveMethod]().then((function(){s.$router.push(s.redirect),s.$vs.notify({color:"success",title:s.$t("GLOBALS.RECORD_CREATED"),text:s.$t("GLOBALS.RECORD_SUCCESSFULLY_CREATED")})})).catch((function(e){s.showValidationErrors(s.userObject),s.errorMessageApi(e.response)}));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changePassword:function(){this.$router.push({name:"users-change-password",params:{user:this.userObject}})}}},d=O,f=s("2877"),b=Object(f["a"])(d,r,n,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-2d0e17c4.2fb31b84.js.map